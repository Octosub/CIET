<%# binding.pry %>
<% if @food.name.present? %>
  <h1><%= @food.name %></h1>
<% else %>
  <h1>Your Scanned Product</h1>
  <div class="d-flex justify-content-center">
    <%= simple_form_for @food, method: "patch" do |f| %>
      <div class="row g-3">
        <div class="col-auto">
          <h1><%= f.input :name, label: false, placeholder: "Enter Product Name" %></h1>
        </div>
        <div class="col-auto">
          <%= f.submit "+", class: "btn btn-primary mb-3" %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
<div class="pictures-container" data-controller="phototoggler">
  <% if @food.photos[1].present? %>
    <% if @food.vegan == "can-be" %>
      <%= cl_image_tag @food.photos[1].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "front", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image yellow-border-image" %>
      <%= cl_image_tag @food.photos[0].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "back", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image yellow-border-image d-none" %>
    <% elsif @food.vegan == "true" %>
      <%= cl_image_tag @food.photos[1].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "front", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image green-border-image" %>
      <%= cl_image_tag @food.photos[0].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "back", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image green-border-image d-none" %>
    <% else %>
      <%= cl_image_tag @food.photos[1].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "front", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image red-border-image" %>
      <%= cl_image_tag @food.photos[0].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "back", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image red-border-image d-none" %>
    <% end %>
  <% else %>
    <%= simple_form_for @food, method: "patch", data: { controller: "autosubmit", 'autosubmit-target': "form"} do |f| %>
      <div class="plus-icon-invisible">
        <div>
          <%= image_tag "icon_plus.png" %> Add Front Photo
        </div>
      </div>
      <%= f.input :photos, as: :file, label: false, input_html: { multiple: true, data: {action: "input->autosubmit#submitPicture"}, class: "invisible-form-small" } %>
    <% end %>
    <% if @food.vegan == "true" %>
      <%= cl_image_tag @food.photos[0].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "back", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image green-border-image" %>
    <% elsif @food.vegan == "can-be" %>
      <%= cl_image_tag @food.photos[0].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "back", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image yellow-border-image" %>
    <% else %>
      <%= cl_image_tag @food.photos[0].key, height: 300, width: 400, crop: :fill, data: {"phototoggler-target": "back", action: "click->phototoggler#togglePhoto"}, class: "big-centered-image red-border-image" %>
    <% end %>
  <% end %>
</div>
<% if @pref_flags.include?("false") %>
  <h2>Your scanned Item is not
    <% @pref_arr.each do |preference| %>
      <% if @food.check(preference) == "false" %>
        <%= "#{preference} " %>
      <% end %>
    <% end %>
  </h2>
<% elsif @pref_flags.include?("can-be") %>
  <h2>Your scanned Item might not be
    <% @pref_arr.each do |preference| %>
      <% if @food.check(preference) == "can-be" %>
        <%= "#{preference} " %>
      <% end %>
    <% end %>
  </h2>
<% else %>
  <h2>Your scanned Item is not
    <% @pref_arr.each do |preference| %>
      <% if @food.check(preference) == "true" %>
        <%= "#{preference} " %>
      <% end %>
    <% end %>
  </h2>
<% end %>
<div class="bar-container">
  <h2>All Ingredients</h2>
  <% @ingredients.each do |ingredient| %>
    <div class="wide-bar-card red-background" data-controller="extended-infos">
      <div class="toggle-grid">
        <p class="text-wrap"><strong><%= ingredient.english_name.capitalize %></strong></p>
        <div class="d-flex">
          <% @pref_arr.each do |preference| %>
            <% if (ingredient.check(preference) == "false") %>
              <%= image_tag("food_icons/not-#{preference}.png", class: "small-icon") %>
            <% elsif (ingredient.check(preference) == "can-be")   %>
              <%= image_tag("food_icons/maybe-#{preference}.png", class: "small-icon") %>
            <% else %>
              <%= image_tag("food_icons/#{preference}.png", class: "small-icon") %>
            <% end %>
          <% end %>
        </div>
        <button class="btn toggler"  data-action="click->extended-infos#revealInfos">&gt;</button>
      </div>
      <div class="d-none extended-infos" data-extended-infos-target="info">
        <p><strong>Description: </strong><%= ingredient.english_description %></p>
        <div class="extended-infos-grid">
          <%= link_to "Google it!", "http://www.google.com/search?q=#{ingredient.english_name}", target: '_blank', class: "btn btn-primary" %>
          <%= link_to "Report", "", class: "btn btn-primary" %>
        </div>
      </div>
    </div>
  <% end %>
  <% unless @unknow_ingredients.nil? %>
    <% @unknow_ingredients.each do |ingredient| %>
      <% translation = DeepL.translate ingredient, "JA", "EN" %>
      <div class="wide-bar-card gray-background" data-controller="extended-infos">
        <div class="toggle-grid">
          <p class="text-wrap"><strong><%= translation %></strong> (<%= ingredient %>) was not found</p>
          <button class="btn toggler"  data-action="click->extended-infos#revealInfos">&gt;</button>
        </div>
        <div class="d-none extended-infos" data-extended-infos-target="info">
          <p>Sorry, we couldn't find that</p>
          <p><strong>Here is what we think it is:</strong> <%= Gpt.describe_unknown_ingredient(translation) %></p>
          <div class="extended-infos-grid">
            <%= link_to "Google it!", "http://www.google.com/search?q=#{ingredient}", target: '_blank', class: "btn btn-primary" %>
            <%= link_to "Report", "", class: "btn btn-primary" %>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
